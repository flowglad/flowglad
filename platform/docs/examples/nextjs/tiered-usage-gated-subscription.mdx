---
title: Tiered Usage-Gated Subscription
description: Learn how to implement tiered usage-gated subscription billing in Next.js with Flowglad.
---

A subscription model with multiple tiers where different features have monthly usage limits. Common for AI chat platforms like ChatGPT.

<Note>
View the complete source code on [GitHub](https://github.com/flowglad/examples/tree/main/nextjs/tiered-usage-gated-subscription).
</Note>

## Prerequisites

- Flowglad account with API key
- Next.js 15+ with App Router
- PostgreSQL database

## Project Structure

```
├── src/
│   ├── app/
│   │   ├── api/
│   │   │   ├── flowglad/[...path]/route.ts
│   │   │   └── usage-events/route.ts
│   │   ├── home-client.tsx
│   │   ├── layout.tsx
│   │   └── page.tsx
│   └── lib/
│       ├── billing-helpers.ts
│       └── flowglad.ts
├── pricing.yaml
└── package.json
```

## Key Concepts

This pricing model combines subscription tiers with per-feature usage limits:

1. **Toggle features** - Binary access to capabilities (e.g., "GPT-5 Thinking", "Agent Mode")
2. **Usage credit grants** - Monthly limits on specific features (e.g., 400 o3 messages/month)
3. **Unlimited vs. limited access** - Features can be gated by toggle only, or by both toggle and usage limit

The key distinction from generation-based billing: here, different features have separate usage pools. A Pro user might have 400 agent messages but unlimited o3 access. This creates natural upgrade paths as users hit limits on specific features.

## Implementation

### Pricing Configuration

The `pricing.yaml` defines features as toggles or usage credit grants. See the [full configuration](https://github.com/flowglad/examples/blob/main/nextjs/tiered-usage-gated-subscription/pricing.yaml) in the repository.

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              USAGE METERS                                   │
│  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐                │
│  │ o3_messages     │ │ o4_mini_messages│ │ agent_messages  │  ...           │
│  │ (sum)           │ │ (sum)           │ │ (sum)           │                │
│  └─────────────────┘ └─────────────────┘ └─────────────────┘                │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
        ┌───────────────────────────┼───────────────────────────┐
        ▼                           ▼                           ▼
┌───────────────────┐   ┌───────────────────────┐   ┌───────────────────────┐
│  TOGGLE FEATURES  │   │  USAGE CREDIT GRANTS  │   │  TRACKING PRODUCTS    │
│  (binary access)  │   │  (monthly limits)     │   │  (usage recording)    │
├───────────────────┤   ├───────────────────────┤   ├───────────────────────┤
│                   │   │                       │   │                       │
│  o3_access        │   │  o3_limit             │   │  o3_tracking          │
│  o4_mini_access   │   │  400/month            │   │  $0 per event         │
│  agent_mode       │   │  → o3_messages meter  │   │  → o3_messages meter  │
│  deep_research    │   │                       │   │                       │
│  context_128k     │   │  o4_mini_limit        │   │  o4_mini_tracking     │
│  ...              │   │  9,000/month          │   │  agent_tracking       │
│                   │   │  → o4_mini_messages   │   │  ...                  │
│                   │   │                       │   │                       │
└───────────────────┘   └───────────────────────┘   └───────────────────────┘
                                    │
              ┌─────────────────────┴─────────────────────┐
              ▼                                           ▼
┌───────────────────────────────────┐   ┌───────────────────────────────────┐
│       SUBSCRIPTION TIERS          │   │          BUSINESS TIER            │
│  (each includes feature slugs)    │   │     (per-seat pricing)            │
├───────────────────────────────────┤   ├───────────────────────────────────┤
│                                   │   │                                   │
│  Free       $0/mo                 │   │  Business    $30/user/mo          │
│             gpt_5_fast            │   │              All Plus features    │
│             context_16k           │   │              + workspace_admin    │
│                                   │   │                                   │
│  Plus       $20/mo                │   └───────────────────────────────────┘
│             gpt_5_thinking        │
│             o3_access + o3_limit  │
│             o4_mini_access + ...  │
│             agent_mode + limit    │
│                                   │
│  Pro        $200/mo               │
│             Unlimited o-models    │
│             agent_limit_pro (400) │
│             deep_research         │
│                                   │
└───────────────────────────────────┘
```

The key distinction in this model: features combine **toggles** (binary access) with **usage credit grants** (monthly limits). Products reference feature slugs to compose each tier's capabilities.

### Checking Feature Access

Use `checkFeatureAccess` to determine if a user has access to a feature. Use `checkUsageBalance` to get their remaining credits on a usage meter.

```tsx src/app/example.tsx
const billing = useBilling();

// Check toggle access
const hasO3Access = billing.checkFeatureAccess('o3_access');

// Check usage balance
const o3Balance = billing.checkUsageBalance('o3_messages');
// o3Balance.availableBalance - credits remaining
```

For features with both a toggle and usage limit, you need to check both. A user might have access to a feature but have exhausted their monthly limit.

### Gating UI Based on Access

Combine feature access and usage balance checks to determine button states.

```tsx src/app/home-client.tsx
const hasFeature = billing.checkFeatureAccess('o3_access');
const balance = billing.checkUsageBalance('o3_messages');
const hasCredits = (balance?.availableBalance ?? 0) > 0;

// Disable if: no feature access, OR has feature but no credits
const isDisabled = !hasFeature || !hasCredits;
```

For unlimited features (toggle only, no usage meter), checking feature access is sufficient.

### Recording Usage Events

When a user consumes a limited feature, record the usage server-side.

```ts src/app/api/usage-events/route.ts
const flowgladServer = flowglad(userId);
const billing = await flowgladServer.getBilling();
const subscription = billing.currentSubscriptions?.[0];

await flowgladServer.createUsageEvent({
  subscriptionId: subscription.id,
  priceSlug: 'o3_tracking',
  amount: 1,
  transactionId: 'unique-id-for-idempotency',
});
```

The `priceSlug` references a usage tracking product that maps to the appropriate usage meter. The `transactionId` ensures idempotency (sent from client).

### Helper Functions

The example includes helpers to work with usage meters and pricing data.

```ts src/lib/billing-helpers.ts
// Get total credits for a meter from the subscription
export function computeUsageTotal(
  usageMeterSlug: string,
  currentSubscription: Subscription,
  pricingModel: PricingModel
): number {
  const featureItems = currentSubscription.experimental?.featureItems ?? [];
  // Sum up usage_credit_grant amounts for this meter
  // ...
}

// Find a usage meter by slug
export function findUsageMeterBySlug(
  usageMeterSlug: string,
  pricingModel: PricingModel
): UsageMeter | null {
  return pricingModel.usageMeters.find(m => m.slug === usageMeterSlug);
}
```

These helpers are useful for displaying usage breakdowns or finding meter info from slugs.

## Next Steps

<CardGroup cols={2}>
  <Card title="View Source Code" icon="github" href="https://github.com/flowglad/examples/tree/main/nextjs/tiered-usage-gated-subscription">
    Browse the complete example implementation
  </Card>
  <Card title="Next.js SDK" icon="book" href="/sdks/nextjs">
    Full Next.js SDK documentation
  </Card>
  <Card title="Feature Access & Usage" icon="gauge" href="/sdks/feature-access-usage">
    Learn more about usage-based billing
  </Card>
  <Card title="Pricing Models" icon="tags" href="/examples/pricing-models">
    Compare different pricing model patterns
  </Card>
</CardGroup>
