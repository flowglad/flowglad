---
title: "Feature Access & Usage"
description: "Check entitlements and usage balances with Flowglad"
---

## Overview

Flowglad tracks feature entitlements and consumption so you can gate premium functionality or enforce [usage-based](/features/usage) plans. Use `checkFeatureAccess` for toggle features, or `checkUsageBalance` and `createUsageEvent` for usage-based features. Learn how to validate access before rendering protected experiences.

### What you can do

- Query customer's feature access using the client or server SDK
- Fetch usage balances for metered features and display remaining quota.
- Combine entitlement checks with subscription state for robust authorization logic.
- ...and more!

### Example: Feature Access Check

<Tabs>
  <Tab title="Client">

  ```tsx
  'use client'

  import { useBilling } from '@flowglad/nextjs'

  export function FeatureAccessGate({
    featureSlug: string
  }) {
    const {
      loaded,
      errors,
      checkFeatureAccess,
    } = useBilling()

    if (!loaded || !checkFeatureAccess) {
      return <p>Loading billing state…</p>
    }

    if (errors) {
      return <p>Unable to load billing data right now.</p>
    }

    return (
      <div>
        <h3>Feature Access</h3>
        {checkFeatureAccess(featureSlug) ? (
          <p>You can use this feature ✨</p>
        ) : (
          <p>You need to upgrade to unlock this feature.</p>
        )}
      </div>
    )
  }
  ```

  </Tab>
  <Tab title="Server">

  ```ts
  import { NextResponse } from 'next/server'
  import { FlowgladServer } from '@flowglad/server'
  import { getSessionUser } from '@/lib/auth'

  const flowgladServer = new FlowgladServer({
    apiKey: process.env.FLOWGLAD_SECRET_KEY,
    getRequestingCustomer: async () => {
      const user = await getSessionUser()
      if (!user) {
        throw new Error('Unauthorized')
      }

      return {
        externalId: user.id,
        email: user.email,
        name: user.name,
      }
    },
  })

  export async function GET(request: Request) {
    const { searchParams } = new URL(request.url)
    const featureSlug = searchParams.get('featureSlug') ?? 'ai-copilot'

    const billing = await flowgladServer.getBilling()
    const hasAccess = billing.checkFeatureAccess(featureSlug)

    return NextResponse.json({ featureSlug, hasAccess })
  }
  ```

  </Tab>
</Tabs>


### Example: Usage Balance Check

<Tabs>
  <Tab title="Client">

  ```tsx
  'use client'

  import { useBilling } from '@flowglad/nextjs'

  export function UsageBalanceIndicator({
    usageMeterSlug,
  }: {
    usageMeterSlug: string
  }) {
    const {
      loaded,
      errors,
      checkUsageBalance,
    } = useBilling()

    if (!loaded || !checkUsageBalance) {
      return <p>Loading usage…</p>
    }

    if (errors) {
      return <p>Unable to load billing data right now.</p>
    }

    const usage = checkUsageBalance(usageMeterSlug)

    return (
      <div>
        <h3>Usage Balance</h3>
        <p>
          Remaining:{' '}
          {usage ? `${usage.availableBalance} credits` : 'No usage meter found'}
        </p>
      </div>
    )
  }
  ```

  </Tab>
  <Tab title="Server">

  ```ts
  import { NextResponse } from 'next/server'
  import { FlowgladServer } from '@flowglad/server'
  import { getSessionUser } from '@/lib/auth'

  const flowgladServer = new FlowgladServer({
    apiKey: process.env.FLOWGLAD_SECRET_KEY,
    getRequestingCustomer: async () => {
      const user = await getSessionUser()
      if (!user) {
        throw new Error('Unauthorized')
      }

      return {
        externalId: user.id,
        email: user.email,
        name: user.name,
      }
    },
  })

  export async function GET(request: Request) {
    const { searchParams } = new URL(request.url)
    const usageMeterSlug = searchParams.get('usageMeterSlug') ?? 'api-calls'

    const billing = await flowgladServer.getBilling()
    const usage = billing.checkUsageBalance(usageMeterSlug)

    return NextResponse.json({
      usageMeterSlug,
      remaining: usage?.availableBalance ?? null,
    })
  }
  ```
  </Tab>
</Tabs>

### Example: Recording Usage from the Server

```ts
import Fastify from 'fastify'
import {
  FlowgladServer,
  type CreateUsageEventParams,
} from '@flowglad/server'
import { getSessionUser } from './auth'

const fastify = Fastify()

const flowgladServer = new FlowgladServer({
  apiKey: process.env.FLOWGLAD_SECRET_KEY,
  getRequestingCustomer: async () => {
    const user = await getSessionUser()
    if (!user) {
      throw new Error('Unauthorized')
    }

    return {
      externalId: user.id,
      email: user.email,
      name: user.name,
    }
  },
})

fastify.post('/api/usage', async (request, reply) => {
  const {
    amount,
    priceId,
    subscriptionId,
    usageMeterId,
    transactionId,
    usageDate,
    properties,
  } = request.body as CreateUsageEventParams

  const usageEvent = await flowgladServer.createUsageEvent({
    amount,
    priceId,
    subscriptionId,
    usageMeterId,
    transactionId,
    usageDate: usageDate ?? Date.now(),
    properties,
  })

  reply.send({ usageEvent })
})

fastify.listen({ port: 3000 })
```
